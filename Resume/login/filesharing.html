<!DOCTYPE html>

<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./styles/styles.css">

    <div id="lognavbar-placeholder"></div>

    <script>
        $(function() {
            $("#lognavbar-placeholder").load("lognavbar.html");
        });

        window.onload = () => {

        }
    </script>

    <script>
        window.onload = () => {

            fetch('http://localhost:8080/viewfiles')
                .then(Response => Response.json())
                .then(json => convertToCards(json));

            console.log("Hello?...")

            function convertToCards(json) {
                console.log("I'm here now")

                let files = JSON.parse(json);
                files.forEach(element => {
                    createCard(element);
                });
            }

            function createCard(obj) {
                console.log("OBJ: " + JSON.stringify(obj))

                //Creating template for each file
                let card = document.createElement("div");
                card.setAttribute("name", obj.title);
                card.className = "card";
                card.addEventListener("click", () => {
                    //Download if clicked!
                    //Should have a reference to path via obj.location (not yet implemented)
                });


                let container = document.createElement("div");
                container.className = "container";


                let filetype = document.createElement("img");
                filetype.setAttribute("name", obj.img);
                console.log(obj.imgLocation);
                filetype.setAttribute("src", obj.imgLocation);
                container.appendChild(filetype)


                let title = document.createElement("p");
                title.textContent = obj.title;
                container.appendChild(title);

                card.appendChild(container);
                document.getElementById("files").appendChild(card);
            }

        }
    </script>

</head>

<body>

    <div class="centering">
        <h1>Please select a file for uploading</h1>
        <form id="fileupload" method="POST" action="/addfile" enctype="multipart/form-data">
            <label for="file">Click the button and pick a file for upload:</label>
            <input type="file" id="file" name="newFile" required>
            <button type="submit" onclick="alert('File is being uploaded, tankyou')">Upload file</button>

        </form>
    </div>

    <div id="files" class="files"></div>

</body>